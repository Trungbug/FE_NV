<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EduSys CSKH Portal — V1 Draft</title>

    <!-- Google Font: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root {
            --color-primary: #1E5BC3;
            /* Trust Blue */
            --color-accent: #FF8C42;
            /* CTA highlight */
            --color-secondary: #00A08A;
            /* Success/Teal */
            --color-neutral-900: #0F172A;
            /* Text main */
            --color-neutral-700: #475569;
            /* Subtext */
            --color-bg: #F8FAFC;
            /* Background */
            --color-surface: #FFFFFF;
            /* Cards */
            --radius-card: 8px;
            --shadow-card: 0 8px 20px rgba(15, 23, 42, 0.06);
        }

        /* Brand utility helpers to pair with Tailwind spacing/typography */
        .bg-primary {
            background-color: var(--color-primary);
        }

        .text-primary {
            color: var(--color-primary);
        }

        .border-primary {
            border-color: var(--color-primary);
        }

        .bg-accent {
            background-color: var(--color-accent);
        }

        .text-accent {
            color: var(--color-accent);
        }

        .bg-secondary {
            background-color: var(--color-secondary);
        }

        .text-secondary {
            color: var(--color-secondary);
        }

        .text-neutral-900 {
            color: var(--color-neutral-900);
        }

        .text-neutral-700 {
            color: var(--color-neutral-700);
        }

        .bg-app {
            background-color: var(--color-bg);
        }

        .bg-surface {
            background-color: var(--color-surface);
        }

        /* Typography scale */
        body {
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';
            color: var(--color-neutral-900);
        }

        .h1 {
            font-size: 28px;
            line-height: 1.2;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .h2 {
            font-size: 20px;
            line-height: 1.35;
            font-weight: 600;
        }

        .body {
            font-size: 15px;
            line-height: 1.6;
        }

        .small {
            font-size: 12px;
            line-height: 1.45;
            color: var(--color-neutral-700);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: .5rem;
            border-radius: 10px;
            font-weight: 600;
            padding: .625rem .9rem;
            transition: all .2s ease;
        }

        .btn:disabled {
            opacity: .6;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--color-primary);
            color: #fff;
            box-shadow: 0 6px 14px rgba(30, 91, 195, .2);
        }

        .btn-primary:hover {
            filter: brightness(.96);
            transform: translateY(-1px);
        }

        .btn-secondary {
            color: var(--color-primary);
            border: 1px solid var(--color-primary);
            background: transparent;
        }

        .btn-secondary:hover {
            background: rgba(30, 91, 195, .06);
        }

        .card {
            background: var(--color-surface);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-card);
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: .35rem;
            border-radius: 999px;
            font-size: 12px;
            padding: .25rem .5rem;
            font-weight: 600;
        }

        .pill-open {
            background: rgba(30, 91, 195, .08);
            color: var(--color-primary);
        }

        .pill-pending {
            background: rgba(255, 140, 66, .12);
            color: var(--color-accent);
        }

        .pill-resolved {
            background: rgba(0, 160, 138, .12);
            color: var(--color-secondary);
        }

        /* Device Artboard Shell */
        .studio-shell {
            background: linear-gradient(180deg, #eef2f7, #f7f9fc);
            min-height: 100vh;
        }

        .studio-controls {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, .6);
            border-bottom: 1px solid rgba(15, 23, 42, .06);
        }

        .frame {
            margin: 24px auto 40px;
            border-radius: 16px;
            background: #fff;
            box-shadow: 0 20px 60px rgba(2, 8, 23, .12);
            overflow: hidden;
            transition: width .25s ease, height .25s ease;
        }

        /* App Layout */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 40;
            background: #fff;
            border-bottom: 1px solid #E5E7EB;
        }

        .app-grid {
            display: flex;
            min-height: calc(100vh - 57px);
        }

        /* header 57px approx */
        .sidebar {
            width: 268px;
            border-right: 1px solid #E5E7EB;
            background: #fff;
            transition: width .25s ease, transform .25s ease;
        }

        .sidebar.collapsed {
            width: 90px;
        }

        .sidebar.hidden-mobile {
            transform: translateX(-100%);
            position: absolute;
            z-index: 45;
        }

        .content {
            flex: 1;
            background: var(--color-bg);
        }

        .container-12 {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .grid-12 {
            display: grid;
            grid-template-columns: repeat(12, minmax(0, 1fr));
            gap: 24px;
        }

        /* Responsive behavior controlled by data-device attribute for the demo artboards */
        /* We simulate breakpoints tied to the selected device */
        .app[data-device="desktop"] .sidebar {
            transform: translateX(0);
        }

        .app[data-device="tablet"] .sidebar {
            width: 90px;
        }

        .app[data-device="mobile"] .sidebar {
            position: absolute;
            transform: translateX(-100%);
        }

        .app[data-device="mobile"] .sidebar.open {
            transform: translateX(0);
        }

        /* Sidebar item styles */
        .nav-item {
            display: flex;
            align-items: center;
            gap: .75rem;
            padding: .625rem .75rem;
            border-radius: 10px;
            color: #334155;
            font-weight: 600;
        }

        .nav-item .label {
            white-space: nowrap;
        }

        .nav-item.active {
            background: rgba(30, 91, 195, .1);
            color: var(--color-primary);
        }

        .nav-item:hover {
            background: #F1F5F9;
        }

        .sidebar.collapsed .label {
            display: none;
        }

        .sidebar.collapsed .chevron {
            display: none;
        }

        /* Simple dropdown and modal backdrops */
        .dropdown {
            position: absolute;
            right: 0;
            top: 110%;
            min-width: 240px;
            background: #fff;
            border: 1px solid #E5E7EB;
            border-radius: 12px;
            box-shadow: 0 16px 36px rgba(2, 8, 23, .12);
        }

        .backdrop {
            position: fixed;
            inset: 0;
            background: rgba(2, 8, 23, .4);
            z-index: 50;
            display: none;
        }

        .backdrop.show {
            display: block;
        }

        /* Table basics */
        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            text-align: left;
            font-weight: 700;
            color: #475569;
            padding: .75rem 1rem;
            background: #F8FAFC;
            border-bottom: 1px solid #E5E7EB;
        }

        .table td {
            padding: .75rem 1rem;
            border-bottom: 1px solid #EEF2F7;
        }

        /* Message bubbles */
        .msg {
            max-width: 80%;
            padding: .6rem .8rem;
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(2, 8, 23, .06);
        }

        .msg.agent {
            background: #E8F0FF;
            color: #0F172A;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 4px;
        }

        .msg.customer {
            background: #fff;
            border: 1px solid #E5E7EB;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 12px;
        }

        /* Status colors for tickets */
        .status-open {
            color: var(--color-primary);
        }

        .status-pending {
            color: var(--color-accent);
        }

        .status-resolved {
            color: var(--color-secondary);
        }

        /* Utility icons */
        .icon {
            width: 18px;
            height: 18px;
        }

        /* Footer */
        .app-footer {
            color: #64748B;
            border-top: 1px solid #E5E7EB;
        }

        /* Smooth fading routes */
        [data-view] {
            display: none;
            opacity: 0;
            transform: translateY(6px);
            transition: opacity .18s ease, transform .18s ease;
        }

        [data-view].active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Component Library grid */
        .swatch {
            border-radius: 10px;
            height: 56px;
            box-shadow: inset 0 0 0 1px rgba(2, 8, 23, .06);
        }

        @media (max-width: 500px) {

            /* Điều chỉnh form filter */
            #inboxFilters {
                flex-direction: column !important;
                gap: 8px !important;
                padding: 12px !important;
            }

            #inboxFilters .flex-wrap {
                flex-direction: column !important;
                width: 100% !important;
                gap: 8px !important;
            }

            /* Làm cho các input, select full width */
            #filterStatus,
            #filterPriority,
            #filterSearch,
            #clearFilters {
                width: 100% !important;
                min-width: 100% !important;
            }

            /* Điều chỉnh bảng ticket */
            .table th,
            .table td {
                padding: 8px !important;
                font-size: 13px !important;
            }

            /* Ẩn cột không quan trọng trên mobile */
            .table th:nth-child(4),
            .table td:nth-child(4),
            .table th:nth-child(5),
            .table td:nth-child(5) {
                display: none !important;
            }

            /* Làm cho pill status và priority gọn hơn */
            .pill {
                padding: 2px 8px !important;
                font-size: 11px !important;
            }
        }
    </style>
</head>

<body class="studio-shell">

    <!-- Artboard Controls -->
    <header class="studio-controls">
        <div class="max-w-[1200px] mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2">
                    <span class="bg-primary text-white font-extrabold rounded-md px-2.5 py-1">EduSys</span>
                    <span class="text-neutral-700 font-semibold">CSKH Portal · V1 Draft</span>
                </div>
                <span class="hidden sm:inline small ml-3 text-neutral-700">Preview in Desktop, Tablet, or Mobile
                    artboards</span>
            </div>
            <div class="flex items-center gap-2" data-layer="artboard-controls">
                <button class="btn btn-secondary" data-device-btn="desktop" aria-pressed="true">Desktop 1440</button>
                <button class="btn btn-secondary" data-device-btn="tablet">Tablet 1024</button>
                <button class="btn btn-secondary" data-device-btn="mobile">Mobile 375</button>
                <button class="btn" id="fitBtn" title="Fit to window">Fit</button>
            </div>
        </div>
    </header>

    <!-- Frame that hosts the app; width changes with artboard controls -->
    <main class="frame" id="frame" style="width: 1200px;">
        <div id="app" class="app" data-device="desktop" data-layer="app-root">

            <!-- Header -->
            <div class="app-header" data-layer="header">
                <div class="mx-auto max-w-[1400px] px-4">
                    <div class="h-14 flex items-center justify-between">
                        <!-- Left: brand + hamburger -->
                        <div class="flex items-center gap-3">
                            <button id="hamburgerBtn"
                                class="md:hidden inline-flex items-center justify-center w-9 h-9 rounded-md hover:bg-gray-100"
                                aria-label="Open menu">
                                <svg class="w-5 h-5 text-neutral-900" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor">
                                    <path stroke-width="2" stroke-linecap="round" d="M4 7h16M4 12h16M4 17h12" />
                                </svg>
                            </button>
                            <div class="flex items-center gap-2">
                                <div
                                    class="bg-primary w-8 h-8 rounded-md grid place-items-center text-white font-extrabold">
                                    E</div>
                                <div class="font-extrabold tracking-tight text-neutral-900">EduSys</div>
                                <div class="text-xs px-2 py-0.5 rounded bg-gray-100 text-gray-600 font-semibold">CSKH
                                </div>
                            </div>
                        </div>

                        <!-- Center: Global Search -->
                        <div class="hidden md:flex flex-1 max-w-[560px] mx-4">
                            <form id="globalSearchForm" class="w-full" onsubmit="event.preventDefault();">
                                <div class="relative">
                                    <input id="globalSearchInput" type="search"
                                        placeholder="Search tickets, students..."
                                        class="w-full bg-[#F1F5F9] rounded-lg pl-10 pr-4 py-2 outline-none focus:ring-2 focus:ring-[var(--color-primary)] placeholder:text-gray-500" />
                                    <svg class="w-5 h-5 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <circle cx="11" cy="11" r="7" stroke-width="2"></circle>
                                        <path d="M20 20l-3-3" stroke-width="2" stroke-linecap="round"></path>
                                    </svg>
                                </div>
                            </form>
                        </div>

                        <!-- Right: Utils -->
                        <div class="flex items-center gap-2 relative">
                            <!-- Notifications -->
                            <div class="relative">
                                <button id="notifBtn"
                                    class="w-10 h-10 rounded-lg hover:bg-gray-100 grid place-items-center relative"
                                    aria-haspopup="true">
                                    <svg class="w-5 h-5 text-neutral-900" viewBox="0 0 24 24" fill="none"
                                        stroke="currentColor">
                                        <path
                                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5"
                                            stroke-width="2" stroke-linecap="round"></path>
                                    </svg>
                                    <span id="notifDot"
                                        class="absolute top-2 right-2 w-2 h-2 rounded-full bg-accent"></span>
                                </button>
                                <div id="notifMenu" class="dropdown hidden">
                                    <div class="p-3 border-b">
                                        <div class="font-semibold">Notifications</div>
                                        <div class="small">Quick updates for your day</div>
                                    </div>
                                    <div id="notifList" class="max-h-64 overflow-auto p-2">
                                        <!-- filled by JS -->
                                    </div>
                                    <div class="p-2">
                                        <button id="markAllRead" class="btn w-full">Mark all as read</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Create -->
                            <button id="quickCreateBtn" class="btn btn-primary" aria-haspopup="dialog">
                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M12 5v14M5 12h14" stroke-width="2" stroke-linecap="round" />
                                </svg>
                                New Ticket
                            </button>

                            <!-- Avatar -->
                            <div class="relative">
                                <button id="avatarBtn"
                                    class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white font-bold">LT</button>
                                <div id="avatarMenu" class="dropdown hidden">
                                    <div class="p-3 border-b">
                                        <div class="font-semibold">Linh Tran</div>
                                        <div class="small">CSKH Staff</div>
                                    </div>
                                    <div class="p-1">
                                        <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-50"
                                            data-nav="settings">Profile & Settings</button>
                                        <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-50"
                                            data-nav="components">Component Library</button>
                                        <button class="w-full text-left px-3 py-2 rounded hover:bg-gray-50"
                                            id="signOutBtn">Sign out</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Body -->
            <div class="app-grid">
                <!-- Sidebar -->
                <aside id="sidebar" class="sidebar" data-layer="sidebar">
                    <div class="h-14 md:hidden"></div>
                    <nav class="p-3">
                        <div class="small uppercase tracking-wider px-2 mb-2 text-neutral-700">Menu</div>
                        <ul class="flex flex-col gap-1">
                            <li><button class="nav-item" data-nav="dashboard"><svg class="icon" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor">
                                        <path d="M3 12h7V3H3v9zm0 9h7v-7H3v7zm11 0h7V12h-7v9zM14 3v7h7V3h-7z"
                                            stroke-width="2" />
                                    </svg><span class="label">Dashboard</span></button></li>
                            <li><button class="nav-item" data-nav="inbox"><svg class="icon" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor">
                                        <path d="M3 7l9 6 9-6" stroke-width="2" />
                                        <path d="M21 7v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7" stroke-width="2" />
                                    </svg><span class="label">Inbox (Tickets)</span></button></li>
                            <li><button class="nav-item" data-nav="students"><svg class="icon" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor">
                                        <path d="M16 14a4 4 0 10-8 0" stroke-width="2" />
                                        <circle cx="12" cy="8" r="3" stroke-width="2" />
                                        <path d="M20 21v-2a4 4 0 00-3-3.87M4 21v-2a4 4 0 013-3.87" stroke-width="2" />
                                    </svg><span class="label">Students</span></button></li>
                            <li><button class="nav-item" data-nav="reports"><svg class="icon" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor">
                                        <path d="M4 19V5m6 14V10m6 9V4" stroke-width="2" stroke-linecap="round" />
                                    </svg><span class="label">Reports</span></button></li>
                            <li><button class="nav-item" data-nav="knowledge"><svg class="icon" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor">
                                        <path d="M4 19.5A2.5 2.5 0 016.5 17H20" stroke-width="2" />
                                        <path d="M4 4h16v13H6.5A2.5 2.5 0 004 19.5V4z" stroke-width="2" />
                                    </svg><span class="label">Knowledge Base</span></button></li>
                            <li><button class="nav-item" data-nav="settings"><svg class="icon" viewBox="0 0 24 24"
                                        fill="none" stroke="currentColor">
                                        <path d="M12 15.5a3.5 3.5 0 100-7 3.5 3.5 0 000 7z" stroke-width="2" />
                                        <path
                                            d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06A1.65 1.65 0 0015 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 008.6 15a1.65 1.65 0 00-1.82-.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06A2 2 0 017.04 4.3l.06.06A1.65 1.65 0 009 4.6a1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0015 8.6a1.65 1.65 0 001.82-.33l.06-.06A2 2 0 0121.7 11.04l-.06.06A1.65 1.65 0 0021.4 13a1.65 1.65 0 00.33 1.82z"
                                            stroke-width="2" />
                                    </svg><span class="label">Settings</span></button></li>
                        </ul>

                        <div class="mt-6 p-2">
                            <button id="collapseBtn" class="w-full btn">Toggle collapse</button>
                        </div>
                    </nav>
                </aside>

                <!-- Main Content -->
                <section class="content" data-layer="content">
                    <div class="container-12">
                        <!-- DASHBOARD -->
                        <div data-view="dashboard" class="active">
                            <div class="mb-4">
                                <div class="h1">Dashboard</div>
                                <div class="small">Overview of your day</div>
                            </div>

                            <!-- KPI cards -->
                            <div class="grid-12">
                                <div class="card p-4" data-grid-span data-span-desktop="4" data-span-tablet="6"
                                    data-span-mobile="12">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="small">Open Tickets</div>
                                            <div class="text-3xl font-extrabold mt-1" id="kpiOpen">0</div>
                                        </div>
                                        <div
                                            class="w-10 h-10 rounded-lg bg-blue-50 text-primary grid place-items-center">
                                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                <path d="M3 7l9 6 9-6" stroke-width="2" />
                                                <path d="M21 7v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7" stroke-width="2" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="card p-4" data-grid-span data-span-desktop="4" data-span-tablet="6"
                                    data-span-mobile="12">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="small">Avg Response Time</div>
                                            <div class="text-3xl font-extrabold mt-1" id="kpiART">—</div>
                                        </div>
                                        <div
                                            class="w-10 h-10 rounded-lg bg-orange-50 text-accent grid place-items-center">
                                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                <path d="M12 8v4l3 3" stroke-width="2" stroke-linecap="round" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                                <div class="card p-4" data-grid-span data-span-desktop="4" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="small">CSAT Score</div>
                                            <div class="text-3xl font-extrabold mt-1" id="kpiCSAT">—</div>
                                        </div>
                                        <div
                                            class="w-10 h-10 rounded-lg bg-emerald-50 text-secondary grid place-items-center">
                                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                <path
                                                    d="M12 17l-5 3 1.5-5.5L4 10l5.6-.5L12 4l2.4 5.5L20 10l-4.5 4.5L17 20z"
                                                    stroke-width="2" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>

                                <!-- Chart placeholder -->
                                <div class="card p-4" data-grid-span data-span-desktop="8" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="h2">Ticket Volume (Last 7 days)</div>
                                        <div class="small text-neutral-700">Line chart placeholder</div>
                                    </div>
                                    <div class="mt-3">
                                        <svg viewBox="0 0 600 220" class="w-full" aria-label="Ticket Volume">
                                            <defs>
                                                <linearGradient id="grad" x1="0" x2="0" y1="0" y2="1">
                                                    <stop offset="0%" stop-color="#1E5BC3" stop-opacity="0.35" />
                                                    <stop offset="100%" stop-color="#1E5BC3" stop-opacity="0.02" />
                                                </linearGradient>
                                            </defs>
                                            <!-- grid -->
                                            <g stroke="#E5E7EB">
                                                <line x1="0" y1="30" x2="600" y2="30" />
                                                <line x1="0" y1="80" x2="600" y2="80" />
                                                <line x1="0" y1="130" x2="600" y2="130" />
                                                <line x1="0" y1="180" x2="600" y2="180" />
                                            </g>
                                            <!-- area -->
                                            <path id="chartArea"
                                                d="M10 150 C 90 90, 150 120, 210 70 S 340 110, 410 80 520 100, 590 60 L 590 210 L 10 210 Z"
                                                fill="url(#grad)"></path>
                                            <!-- line -->
                                            <path id="chartLine"
                                                d="M10 150 C 90 90, 150 120, 210 70 S 340 110, 410 80 520 100, 590 60"
                                                stroke="#1E5BC3" stroke-width="3" fill="none"></path>
                                            <!-- dots -->
                                            <g fill="#1E5BC3">
                                                <circle cx="10" cy="150" r="4" />
                                                <circle cx="90" cy="90" r="4" />
                                                <circle cx="150" cy="120" r="4" />
                                                <circle cx="210" cy="70" r="4" />
                                                <circle cx="340" cy="110" r="4" />
                                                <circle cx="410" cy="80" r="4" />
                                                <circle cx="520" cy="100" r="4" />
                                                <circle cx="590" cy="60" r="4" />
                                            </g>
                                        </svg>
                                    </div>
                                </div>

                                <!-- Recent tickets -->
                                <div class="card p-4" data-grid-span data-span-desktop="4" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-2">Recent Tickets</div>
                                    <div class="small mb-3 text-neutral-700">Preview of the latest activity</div>
                                    <div id="recentTickets" class="space-y-2">
                                        <!-- filled by JS -->
                                    </div>
                                    <div class="mt-3">
                                        <button class="btn btn-secondary w-full" data-nav="inbox">Go to Inbox</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- INBOX -->
                        <div data-view="inbox">
                            <div class="mb-4">
                                <div class="h1">Inbox</div>
                                <div class="small">Filter and manage tickets</div>
                            </div>

                            <!-- Filters -->
                            <form id="inboxFilters" class="card p-3 mb-4" onsubmit="event.preventDefault();">
                                <div class="flex flex-wrap items-center gap-2">
                                    <select id="filterStatus" class="bg-[#F8FAFC] border rounded-lg px-3 py-2">
                                        <option value="">All statuses</option>
                                        <option>Open</option>
                                        <option>Pending</option>
                                        <option>Resolved</option>
                                    </select>
                                    <select id="filterPriority" class="bg-[#F8FAFC] border rounded-lg px-3 py-2">
                                        <option value="">All priorities</option>
                                        <option>Low</option>
                                        <option>Medium</option>
                                        <option>High</option>
                                    </select>
                                    <div class="relative flex-1 min-w-[200px]">
                                        <input id="filterSearch"
                                            class="w-full bg-[#F8FAFC] border rounded-lg pl-9 pr-3 py-2"
                                            placeholder="Search subject...">
                                        <svg class="w-4 h-4 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <circle cx="11" cy="11" r="7" stroke-width="2" />
                                            <path d="M20 20l-3-3" stroke-width="2" stroke-linecap="round"></path>
                                        </svg>
                                    </div>
                                    <button id="clearFilters" class="btn">Clear</button>
                                </div>
                            </form>

                            <div class="card overflow-hidden">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Subject</th>
                                            <th>Status</th>
                                            <th>Priority</th>
                                            <th>Channel</th>
                                            <th>Updated</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ticketTableBody" data-layer="table/ticket-row">
                                        <!-- rows via JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- TICKET DETAIL -->
                        <div data-view="ticket">
                            <!-- Thêm vào phần header của ticket detail, cạnh nút "Set Pending" -->
                            <div class="mb-3 flex items-center justify-between">
                                <div>
                                    <div class="h1 flex items-center gap-2">
                                        <span id="ticketTitle">Ticket</span>
                                        <span id="ticketStatusPill" class="pill pill-open">Open</span>
                                    </div>
                                    <div class="small">Assigned to: <span id="ticketAssignee">—</span></div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <button class="btn" data-nav="inbox">Back to Inbox</button>
                                    <button id="escalateBtn" class="btn btn-secondary">
                                        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round" />
                                        </svg>
                                        Escalate
                                    </button>
                                    <button id="toggleStatusBtn" class="btn btn-secondary">Set Pending</button>
                                </div>
                            </div>

                            <div class="grid-12">
                                <div class="card p-4" data-grid-span data-span-desktop="8" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-3">Conversation</div>
                                    <div id="conversation" class="space-y-3 min-h-[220px]">
                                        <!-- bubbles -->
                                    </div>
                                    <form id="replyForm" class="mt-3" onsubmit="event.preventDefault();">
                                        <textarea id="replyInput" class="w-full bg-[#F8FAFC] border rounded-lg p-3"
                                            rows="3" placeholder="Write a reply..."></textarea>
                                        <div class="flex items-center justify-between mt-2">
                                            <div class="small text-neutral-700">Reply will be added to the conversation
                                            </div>
                                            <button class="btn btn-primary" id="sendReplyBtn">
                                                <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                    <path d="M22 2L11 13" stroke-width="2" />
                                                    <path d="M22 2l-7 20-4-9-9-4 20-7z" stroke-width="2"
                                                        stroke-linejoin="round" />
                                                </svg>
                                                Send
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <div class="card p-4" data-grid-span data-span-desktop="4" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-3">Details</div>
                                    <div class="space-y-2 body">
                                        <div><span class="small">Ticket ID:</span> <span id="ticketIdText"
                                                class="font-semibold">—</span></div>
                                        <div><span class="small">Student:</span> <button id="goToStudentBtn"
                                                class="text-primary font-semibold underline underline-offset-2">—</button>
                                        </div>
                                        <div><span class="small">Priority:</span> <span id="ticketPriorityText"
                                                class="font-semibold">—</span></div>
                                        <div><span class="small">Channel:</span> <span id="ticketChannelText"
                                                class="font-semibold">—</span></div>
                                        <div><span class="small">Last updated:</span> <span id="ticketUpdatedText"
                                                class="font-semibold">—</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- STUDENT PROFILE OVERVIEW -->
                        <div data-view="student-profile">
                            <div class="mb-4">
                                <div class="h1" id="studentNameTitle">Student Profile</div>
                                <div class="small">Overview and history</div>
                            </div>

                            <div class="grid-12">
                                <!-- Summary Card -->
                                <div class="card p-4" data-grid-span data-span-desktop="12" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="flex flex-wrap items-center gap-4">
                                        <div class="w-14 h-14 rounded-full bg-gradient-to-br from-indigo-500 to-blue-600 text-white font-bold grid place-items-center"
                                            id="studentAvatar">S</div>
                                        <div class="mr-auto">
                                            <div class="text-xl font-bold" id="studentName">—</div>
                                            <div class="small" id="studentContact">—</div>
                                        </div>
                                        <button class="btn btn-secondary" data-nav="students">Back to Students</button>
                                    </div>
                                </div>

                                <!-- Tabs -->
                                <div class="card p-0 overflow-hidden" data-grid-span data-span-desktop="12"
                                    data-span-tablet="12" data-span-mobile="12">
                                    <div class="flex border-b">
                                        <button class="px-4 py-3 font-semibold text-primary border-b-2 border-primary"
                                            data-student-tab="tickets">Tickets history</button>
                                        <button class="px-4 py-3 font-semibold hover:bg-gray-50"
                                            data-student-tab="notes">Notes</button>
                                        <button class="px-4 py-3 font-semibold hover:bg-gray-50"
                                            data-student-tab="timeline">Course timeline</button>
                                    </div>
                                    <div class="p-4">
                                        <div data-tab-panel="tickets">
                                            <div id="studentTickets" class="space-y-2"></div>
                                        </div>
                                        <div data-tab-panel="notes" class="hidden">
                                            <form id="addNoteForm" onsubmit="event.preventDefault();" class="mb-3">
                                                <textarea id="noteInput"
                                                    class="w-full bg-[#F8FAFC] border rounded-lg p-3" rows="3"
                                                    placeholder="Add a note..."></textarea>
                                                <div class="mt-2 flex justify-end">
                                                    <button class="btn btn-primary" id="addNoteBtn">Add note</button>
                                                </div>
                                            </form>
                                            <div id="notesList" class="space-y-2"></div>
                                        </div>
                                        <div data-tab-panel="timeline" class="hidden">
                                            <div class="space-y-3">
                                                <div class="flex items-start gap-3">
                                                    <div class="w-2 h-2 mt-2 rounded-full bg-secondary"></div>
                                                    <div>
                                                        <div class="font-semibold">Enrolled in "Intro to Data"</div>
                                                        <div class="small">Feb 3, 2025</div>
                                                    </div>
                                                </div>
                                                <div class="flex items-start gap-3">
                                                    <div class="w-2 h-2 mt-2 rounded-full bg-primary"></div>
                                                    <div>
                                                        <div class="font-semibold">Completed Module 1</div>
                                                        <div class="small">Feb 10, 2025</div>
                                                    </div>
                                                </div>
                                                <div class="flex items-start gap-3">
                                                    <div class="w-2 h-2 mt-2 rounded-full bg-accent"></div>
                                                    <div>
                                                        <div class="font-semibold">Requested support on assignment</div>
                                                        <div class="small">Feb 12, 2025</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- STUDENTS LIST (simple draft to open profile) -->
                        <div data-view="students">
                            <div class="mb-4">
                                <div class="h1">Students</div>
                                <div class="small">Basic access list (draft)</div>
                            </div>
                            <div class="card p-3">
                                <div id="studentsList" class="divide-y">
                                    <!-- via JS -->
                                </div>
                            </div>
                        </div>

                        <!-- REPORTS (placeholder) -->
                        <div data-view="reports">
                            <div class="mb-4">
                                <div class="h1">Reports</div>
                                <div class="small">Basic access (placeholder)</div>
                            </div>
                            <div class="grid-12">
                                <div class="card p-4" data-grid-span data-span-desktop="12" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-2">Weekly summary</div>
                                    <div class="small text-neutral-700">Placeholder chart</div>
                                    <div class="mt-4 grid grid-cols-3 gap-4">
                                        <div class="h-24 rounded bg-blue-50"></div>
                                        <div class="h-24 rounded bg-orange-50"></div>
                                        <div class="h-24 rounded bg-emerald-50"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- KNOWLEDGE BASE (placeholder) -->
                        <div data-view="knowledge">
                            <div class="mb-4">
                                <div class="h1">Knowledge Base</div>
                                <div class="small">Quick answers & articles</div>
                            </div>
                            <div class="card p-4 space-y-3">
                                <div class="flex items-center justify-between">
                                    <div class="font-semibold">Resetting passwords for students</div>
                                    <button class="btn btn-secondary">Open</button>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="font-semibold">Refund policy overview</div>
                                    <button class="btn btn-secondary">Open</button>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="font-semibold">How to submit assignments</div>
                                    <button class="btn btn-secondary">Open</button>
                                </div>
                            </div>
                        </div>

                        <!-- SETTINGS (placeholder) -->
                        <div data-view="settings">
                            <div class="mb-4">
                                <div class="h1">Settings</div>
                                <div class="small">Profile & preferences</div>
                            </div>
                            <form class="card p-4 max-w-xl" onsubmit="event.preventDefault();">
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="small block mb-1">First name</label>
                                        <input class="w-full bg-[#F8FAFC] border rounded-lg px-3 py-2" value="Linh">
                                    </div>
                                    <div>
                                        <label class="small block mb-1">Last name</label>
                                        <input class="w-full bg-[#F8FAFC] border rounded-lg px-3 py-2" value="Tran">
                                    </div>
                                    <div class="col-span-2">
                                        <label class="small block mb-1">Email</label>
                                        <input class="w-full bg-[#F8FAFC] border rounded-lg px-3 py-2"
                                            value="linh.tran@edusys.vn">
                                    </div>
                                </div>
                                <div class="mt-4 flex items-center gap-2">
                                    <button class="btn btn-primary">Save</button>
                                    <span class="small">This is a demo form</span>
                                </div>
                            </form>
                        </div>

                        <!-- COMPONENT LIBRARY -->
                        <div data-view="components">
                            <div class="mb-4">
                                <div class="h1">Component Library</div>
                                <div class="small">Design tokens and core UI components</div>
                            </div>

                            <div class="grid-12 items-start">
                                <!-- Colors -->
                                <div class="card p-4" data-grid-span data-span-desktop="6" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-3">Colors</div>
                                    <div class="grid grid-cols-3 gap-3">
                                        <div>
                                            <div class="swatch bg-primary"></div>
                                            <div class="small mt-1">Primary #1E5BC3</div>
                                        </div>
                                        <div>
                                            <div class="swatch bg-accent"></div>
                                            <div class="small mt-1">Accent #FF8C42</div>
                                        </div>
                                        <div>
                                            <div class="swatch bg-secondary"></div>
                                            <div class="small mt-1">Secondary #00A08A</div>
                                        </div>
                                        <div>
                                            <div class="swatch" style="background:#0F172A"></div>
                                            <div class="small mt-1">Neutral 900 #0F172A</div>
                                        </div>
                                        <div>
                                            <div class="swatch" style="background:#475569"></div>
                                            <div class="small mt-1">Neutral 700 #475569</div>
                                        </div>
                                        <div>
                                            <div class="swatch" style="background:#F8FAFC"></div>
                                            <div class="small mt-1">Background #F8FAFC</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Typography -->
                                <div class="card p-4" data-grid-span data-span-desktop="6" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-3">Typography</div>
                                    <div class="mb-2 h1">Heading 1 · 28px</div>
                                    <div class="mb-2 h2">Heading 2 · 20px</div>
                                    <div class="mb-2 body">Body · 14–16px recommended for content</div>
                                    <div class="small">Small · 12px for hints and meta</div>
                                </div>

                                <!-- Buttons -->
                                <div class="card p-4" data-grid-span data-span-desktop="6" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-3">Buttons</div>
                                    <div class="space-x-2">
                                        <button class="btn btn-primary">Primary</button>
                                        <button class="btn btn-secondary">Secondary</button>
                                        <button class="btn">Tertiary</button>
                                    </div>
                                </div>

                                <!-- Cards & Pills -->
                                <div class="card p-4" data-grid-span data-span-desktop="6" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-3">Cards & Status</div>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="card p-3">
                                            <div class="font-semibold">Card</div>
                                            <div class="small">Radius 8px · Shadow subtle</div>
                                        </div>
                                        <div class="space-x-2">
                                            <span class="pill pill-open">Open</span>
                                            <span class="pill pill-pending">Pending</span>
                                            <span class="pill pill-resolved">Resolved</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Inputs -->
                                <div class="card p-4" data-grid-span data-span-desktop="12" data-span-tablet="12"
                                    data-span-mobile="12">
                                    <div class="h2 mb-3">Inputs</div>
                                    <div class="grid grid-cols-3 gap-3">
                                        <input class="bg-[#F8FAFC] border rounded-lg px-3 py-2"
                                            placeholder="Text input" />
                                        <select class="bg-[#F8FAFC] border rounded-lg px-3 py-2">
                                            <option>Dropdown</option>
                                        </select>
                                        <div class="relative">
                                            <input class="w-full bg-[#F8FAFC] border rounded-lg pl-9 pr-3 py-2"
                                                placeholder="Search">
                                            <svg class="w-4 h-4 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                                <circle cx="11" cy="11" r="7" stroke-width="2" />
                                                <path d="M20 20l-3-3" stroke-width="2" stroke-linecap="round"></path>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <!-- Footer -->
                    <footer class="app-footer px-6 py-4 text-center small" data-layer="footer">
                        © 2025 EduSys · CSKH Portal · v1.0 Draft
                    </footer>
                </section>
            </div>

            <!-- Backdrop -->
            <div id="backdrop" class="backdrop"></div>

            <!-- Quick Create Modal -->
            <div id="createModal"
                class="fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl w-[520px] max-w-[92vw] hidden z-50">
                <form id="createForm" onsubmit="event.preventDefault();" class="p-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="h2">New Ticket</div>
                        <button type="button" id="closeCreate"
                            class="w-9 h-9 rounded-md hover:bg-gray-100 grid place-items-center">
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M6 6l12 12M18 6L6 18" stroke-width="2" stroke-linecap="round" />
                            </svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="col-span-2">
                            <label class="small block mb-1">Subject</label>
                            <input id="createSubject" class="w-full bg-[#F8FAFC] border rounded-lg px-3 py-2"
                                placeholder="Short description">
                        </div>
                        <div>
                            <label class="small block mb-1">Priority</label>
                            <select id="createPriority" class="w-full bg-[#F8FAFC] border rounded-lg px-3 py-2">
                                <option>Low</option>
                                <option>Medium</option>
                                <option>High</option>
                            </select>
                        </div>
                        <div>
                            <label class="small block mb-1">Channel</label>
                            <select id="createChannel" class="w-full bg-[#F8FAFC] border rounded-lg px-3 py-2">
                                <option>email</option>
                                <option>chat</option>
                                <option>phone</option>
                            </select>
                        </div>
                        <div class="col-span-2">
                            <label class="small block mb-1">Student</label>
                            <select id="createStudent" class="w-full bg-[#F8FAFC] border rounded-lg px-3 py-2">
                                <!-- filled by JS -->
                            </select>
                        </div>
                    </div>
                    <div class="mt-4 flex items-center justify-end gap-2">
                        <button type="button" class="btn" id="cancelCreate">Cancel</button>
                        <button class="btn btn-primary" id="createSubmit">Create</button>
                    </div>
                </form>
            </div>

            <!-- Toast -->
            <div id="toast"
                class="fixed bottom-5 left-1/2 -translate-x-1/2 bg-neutral-900 text-white px-4 py-2 rounded-lg shadow-lg hidden z-50">
            </div>

        </div>
    </main>

    <script>
        // --- Sample Data ---
        const students = [
            { id: 'stu-1', name: 'Mai Nguyen', email: 'mai.nguyen@edusys.vn', phone: '+84 90 123 4567', notes: [] },
            { id: 'stu-2', name: 'Anh Le', email: 'anh.le@edusys.vn', phone: '+84 90 555 7711', notes: [] },
            { id: 'stu-3', name: 'Bao Pham', email: 'bao.pham@edusys.vn', phone: '+84 93 666 8899', notes: [] },
        ];

        const tickets = [
            {
                id: 'TCK-1024', subject: 'Cannot access course materials', status: 'Open', priority: 'High', channel: 'email', updated: '2h ago', assignee: 'Linh Tran', studentId: 'stu-1',
                messages: [
                    { sender: 'Customer', text: 'Hi, I cannot access Module 2. It shows an error.', time: '09:10' },
                    { sender: 'Agent', text: 'Hello Mai, I’m checking this for you now.', time: '09:12' }
                ]
            },
            {
                id: 'TCK-1023', subject: 'Refund request for course', status: 'Pending', priority: 'Medium', channel: 'chat', updated: '6h ago', assignee: 'Linh Tran', studentId: 'stu-2',
                messages: [
                    { sender: 'Customer', text: 'I would like to request a refund.', time: '08:35' },
                    { sender: 'Agent', text: 'Sure, I’ll guide you through our policy.', time: '08:40' }
                ]
            },
            {
                id: 'TCK-1022', subject: 'Assignment submission issue', status: 'Resolved', priority: 'Low', channel: 'phone', updated: 'Yesterday', assignee: 'Minh Vu', studentId: 'stu-3',
                messages: [
                    { sender: 'Customer', text: 'File upload keeps failing.', time: '14:10' },
                    { sender: 'Agent', text: 'It’s fixed now. Please try again.', time: '14:25' }
                ]
            },
            {
                id: 'TCK-1021', subject: 'Change email address', status: 'Open', priority: 'Low', channel: 'email', updated: '3h ago', assignee: 'Lan Pham', studentId: 'stu-2',
                messages: [
                    { sender: 'Customer', text: 'I need to update my email address.', time: '10:40' }
                ]
            },
            {
                id: 'TCK-1020', subject: 'Certificate not showing', status: 'Open', priority: 'Medium', channel: 'chat', updated: '1d ago', assignee: 'Linh Tran', studentId: 'stu-1',
                messages: [
                    { sender: 'Customer', text: 'My certificate does not appear.', time: '12:15' }
                ]
            }
        ];

        let appState = {
            currentView: 'tickets', // tickets | ticket | student-profile | students | reports | knowledge | settings | components
            selectedTicketId: null,
            selectedStudentId: null,
            device: 'desktop', // desktop | tablet | mobile
            sidebarCollapsed: false,
            notifications: [
                { id: 'n1', text: 'New ticket from Mai Nguyen', read: false },
                { id: 'n2', text: 'Ticket TCK-1023 waiting for response', read: false },
                { id: 'n3', text: 'Daily summary is ready', read: true },
            ]
        };

        // --- Helpers ---
        const $ = sel => document.querySelector(sel);
        const $$ = sel => Array.from(document.querySelectorAll(sel));
        function showToast(msg) { const t = $('#toast'); t.textContent = msg; t.classList.remove('hidden'); setTimeout(() => t.classList.add('hidden'), 1800); }
        function formatStatusPill(status) {
            const base = 'pill ';
            if (status === 'Open') return base + 'pill-open';
            if (status === 'Pending') return base + 'pill-pending';
            return base + 'pill-resolved';
        }
        function channelIcon(channel) {
            if (channel === 'email') return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M3 7l9 6 9-6" stroke-width="2"/><path d="M21 7v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7" stroke-width="2"/></svg>';
            if (channel === 'chat') return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M21 15a4 4 0 01-4 4H7l-4 4V5a4 4 0 014-4h10a4 4 0 014 4v10z" stroke-width="2"/></svg>';
            return '<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M22 16.92V19a2 2 0 01-2.18 2A19.79 19.79 0 013 5.18 2 2 0 015 3h2.09a2 2 0 012 1.72 12.44 12.44 0 00.7 2.81 2 2 0 01-.45 2.11L8 11a16 16 0 006 6l1.36-1.36a2 2 0 012.11-.45 12.44 12.44 0 002.81.7A2 2 0 0122 16.92z" stroke-width="2"/></svg>';
        }
        function applyActiveNav() {
            $$('.nav-item').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.nav === appState.currentView);
            });
        }
        function setView(view) {
            appState.currentView = view;
            // hash navigation
            try { location.hash = '#' + view; } catch (e) { }
            $$('[data-view]').forEach(v => v.classList.remove('active'));
            const el = document.querySelector(`[data-view="${view}"]`);
            if (el) { el.classList.add('active'); }
            applyActiveNav();
            // close mobile sidebar on navigation
            if (appState.device === 'mobile') { $('#sidebar').classList.remove('open'); }
        }

        function updateKpis() {
            const openCount = tickets.filter(t => t.status === 'Open').length;
            $('#kpiOpen').textContent = openCount;
            $('#kpiART').textContent = '1h 42m';
            $('#kpiCSAT').textContent = '4.7/5';
        }


        function renderRecentTickets() {
            const recent = tickets.slice(0, 4);
            const c = $('#recentTickets'); c.innerHTML = '';
            recent.forEach(t => {
                const row = document.createElement('button');
                row.className = 'w-full text-left flex items-center justify-between p-2 rounded hover:bg-gray-50';
                row.innerHTML = `
          <div class="flex items-center gap-2">
            <span class="${formatStatusPill(t.status)}">${t.status}</span>
            <span class="font-semibold">${t.subject}</span>
          </div>
          <div class="small">${t.updated}</div>`;
                row.addEventListener('click', () => { openTicket(t.id); });
                c.appendChild(row);
            });
        }

        // Inbox
        function renderTicketTable() {
            const tbody = $('#ticketTableBody'); tbody.innerHTML = '';
            const status = $('#filterStatus').value;
            const pri = $('#filterPriority').value;
            const q = $('#filterSearch').value.trim().toLowerCase();
            tickets
                .filter(t => !status || t.status === status)
                .filter(t => !pri || t.priority === pri)
                .filter(t => !q || t.subject.toLowerCase().includes(q))
                .forEach(t => {
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-50 cursor-pointer';
                    tr.innerHTML = `
            <td class="font-semibold">${t.subject}</td>
            <td><span class="${formatStatusPill(t.status)}">${t.status}</span></td>
            <td>${t.priority}</td>
            <td class="text-neutral-700 flex items-center gap-2">${channelIcon(t.channel)} <span class="small capitalize">${t.channel}</span></td>
            <td class="small">${t.updated}</td>
          `;
                    tr.addEventListener('click', () => openTicket(t.id));
                    tbody.appendChild(tr);
                });
        }

        function openTicket(id) {
            const t = tickets.find(tt => tt.id === id);
            if (!t) return;
            appState.selectedTicketId = id;
            // Header info
            $('#ticketTitle').textContent = `${t.id} · ${t.subject}`;
            const pill = $('#ticketStatusPill');
            pill.className = formatStatusPill(t.status);
            pill.textContent = t.status;
            $('#ticketAssignee').textContent = t.assignee || '—';
            // Right panel
            $('#ticketIdText').textContent = t.id;
            const stu = students.find(s => s.id === t.studentId);
            const studentBtn = $('#goToStudentBtn');
            studentBtn.textContent = stu ? stu.name : '—';
            studentBtn.onclick = () => openStudent(t.studentId);
            $('#ticketPriorityText').textContent = t.priority;
            $('#ticketChannelText').textContent = t.channel;
            $('#ticketUpdatedText').textContent = t.updated;

            // Conversation
            const conv = $('#conversation'); conv.innerHTML = '';
            t.messages.forEach(m => {
                const wrap = document.createElement('div');
                wrap.className = `flex ${m.sender === 'Agent' ? 'justify-end' : 'justify-start'}`;
                const bubble = document.createElement('div');
                bubble.className = `msg ${m.sender === 'Agent' ? 'agent' : 'customer'}`;
                bubble.innerHTML = `<div class="body">${m.text}</div><div class="small mt-1 text-neutral-700">${m.sender} · ${m.time}</div>`;
                wrap.appendChild(bubble);
                conv.appendChild(wrap);
            });

            // Toggle Status Button
            const toggleBtn = $('#toggleStatusBtn');
            if (t.status === 'Open') { toggleBtn.textContent = 'Set Pending'; }
            else if (t.status === 'Pending') { toggleBtn.textContent = 'Resolve'; }
            else { toggleBtn.textContent = 'Reopen'; }
            toggleBtn.onclick = () => {
                const stateFlow = { 'Open': 'Pending', 'Pending': 'Resolved', 'Resolved': 'Open' };
                t.status = stateFlow[t.status];
                t.updated = 'Just now';
                openTicket(t.id); // re-render
                renderTicketTable();
                renderRecentTickets();
                updateKpis();
            };
            $('#escalateBtn').onclick = () => {
                t.priority = 'High';
                t.updated = 'Just now';
                showToast('Đã leo thang ticket ' + t.id);
                openTicket(t.id); // re-render
                renderTicketTable();
                renderRecentTickets();
            };
            setView('ticket');
        }

        // Students
        function renderStudentsList() {
            const wrap = $('#studentsList'); wrap.innerHTML = '';
            students.forEach(s => {
                const btn = document.createElement('button');
                btn.className = 'w-full text-left px-3 py-3 hover:bg-gray-50 flex items-center gap-3';
                btn.innerHTML = `
          <div class="w-9 h-9 rounded-full bg-blue-600 text-white grid place-items-center font-semibold">${(s.name || '?').split(' ').map(p => p[0]).slice(0, 2).join('')}</div>
          <div>
            <div class="font-semibold">${s.name}</div>
            <div class="small">${s.email} · ${s.phone}</div>
          </div>
        `;
                btn.addEventListener('click', () => openStudent(s.id));
                wrap.appendChild(btn);
            });
        }

        function openStudent(id) {
            const s = students.find(st => st.id === id);
            if (!s) return;
            appState.selectedStudentId = id;
            $('#studentNameTitle').textContent = s.name;
            $('#studentName').textContent = s.name;
            $('#studentContact').textContent = `${s.email} · ${s.phone}`;
            $('#studentAvatar').textContent = s.name.split(' ').map(p => p[0]).slice(0, 2).join('');
            // Tickets for student
            const list = $('#studentTickets'); list.innerHTML = '';
            tickets.filter(t => t.studentId === id).forEach(t => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-2 rounded hover:bg-gray-50';
                item.innerHTML = `
          <div class="flex items-center gap-2">
            <span class="${formatStatusPill(t.status)}">${t.status}</span>
            <span class="font-semibold">${t.subject}</span>
          </div>
          <button class="btn btn-secondary">Open</button>
        `;
                item.querySelector('button').addEventListener('click', () => openTicket(t.id));
                list.appendChild(item);
            });

            // Notes
            const notesList = $('#notesList'); notesList.innerHTML = '';
            s.notes.slice().reverse().forEach(n => {
                const row = document.createElement('div');
                row.className = 'p-2 rounded bg-[#F8FAFC] border';
                row.innerHTML = `<div class="body">${n.text}</div><div class="small mt-1">${n.time}</div>`;
                notesList.appendChild(row);
            });

            setStudentTab('tickets');
            setView('student-profile');
        }

        // Student tabs
        function setStudentTab(which) {
            $$('[data-student-tab]').forEach(b => {
                const active = b.dataset.studentTab === which;
                b.classList.toggle('text-primary', active);
                b.classList.toggle('border-b-2', active);
                b.classList.toggle('border-primary', active);
                b.classList.toggle('hover:bg-gray-50', !active);
            });
            $$('[data-tab-panel]').forEach(p => {
                p.classList.toggle('hidden', p.getAttribute('data-tab-panel') !== which);
            });
        }

        // Global Search: focus on tickets and students
        function globalSearch(q) {
            const term = q.trim().toLowerCase();
            if (appState.currentView === 'inbox') {
                $('#filterSearch').value = term;
                renderTicketTable();
                showToast('Filtered tickets by search');
            } else if (appState.currentView === 'students') {
                // Simple: navigate to Students and highlight match
                setView('students');
                // For brevity, no highlight—could be added later
                showToast('Search focuses on tickets & students');
            } else {
                // default: go to Inbox with query
                setView('inbox');
                $('#filterSearch').value = term;
                renderTicketTable();
                showToast('Filtered tickets by search');
            }
        }

        // Notifications
        function renderNotifications() {
            const list = $('#notifList'); list.innerHTML = '';
            appState.notifications.forEach(n => {
                const row = document.createElement('div');
                row.className = 'px-3 py-2 rounded flex items-center justify-between hover:bg-gray-50';
                row.innerHTML = `<span class="${n.read ? '' : 'font-semibold'}">${n.text}</span>
          <span class="w-2 h-2 rounded-full ${n.read ? 'bg-transparent' : 'bg-accent'}"></span>`;
                row.addEventListener('click', () => {
                    n.read = true; renderNotifications();
                    updateNotifDot();
                });
                list.appendChild(row);
            });
        }
        function updateNotifDot() {
            const unread = appState.notifications.some(n => !n.read);
            $('#notifDot').style.display = unread ? 'block' : 'none';
        }

        // Component Library: no dynamic code needed beyond layout

        // Grid spans per device
        function applyGridSpans() {
            const device = appState.device;
            $$('[data-grid-span]').forEach(el => {
                // Remove existing col-span classes
                el.className = el.className.replace(/col-span-\d{1,2}/g, '').trim();
                const span = el.getAttribute(`data-span-${device}`) || '12';
                el.classList.add(`col-span-${span}`);
            });
        }

        // Sidebar collapse toggle
        function setSidebarCollapsed(collapsed) {
            appState.sidebarCollapsed = collapsed;
            const s = $('#sidebar');
            s.classList.toggle('collapsed', collapsed);
        }

        // Device controls
        function setDevice(device) {
            appState.device = device;
            $('#app').setAttribute('data-device', device);
            // Frame width
            const frame = $('#frame');
            if (device === 'desktop') { frame.style.width = '1200px'; }
            if (device === 'tablet') { frame.style.width = '1024px'; }
            if (device === 'mobile') { frame.style.width = '375px'; }
            // Buttons pressed state
            $$('[data-device-btn]').forEach(b => b.setAttribute('aria-pressed', String(b.dataset.deviceBtn === device)));
            applyGridSpans();
            // Sidebar behavior
            if (device === 'tablet') { setSidebarCollapsed(true); }
            if (device === 'desktop') { setSidebarCollapsed(false); $('#sidebar').classList.remove('open'); }
            if (device === 'mobile') { $('#sidebar').classList.remove('collapsed'); }
        }

        function fitToWindow() {
            const frame = $('#frame');
            frame.style.width = Math.min(window.innerWidth - 24, 1200) + 'px';
            $$('[data-device-btn]').forEach(b => b.setAttribute('aria-pressed', 'false'));
            applyGridSpans();
        }

        // --- Event bindings ---
        window.addEventListener('hashchange', () => {
            const view = location.hash.replace('#', '') || 'dashboard';
            if ($(`[data-view="${view}"]`)) setView(view);
        });

        // Nav clicks
        document.addEventListener('click', (e) => {
            const nav = e.target.closest('[data-nav]');
            if (nav) {
                setView(nav.dataset.nav);
            }
        });

        // Sidebar controls
        $('#collapseBtn').addEventListener('click', () => setSidebarCollapsed(!appState.sidebarCollapsed));
        $('#hamburgerBtn').addEventListener('click', () => $('#sidebar').classList.toggle('open'));

        // Filters
        $('#inboxFilters').addEventListener('input', renderTicketTable);
        $('#clearFilters').addEventListener('click', () => {
            $('#filterStatus').value = ''; $('#filterPriority').value = ''; $('#filterSearch').value = '';
            renderTicketTable();
        });

        // Global Search
        $('#globalSearchForm').addEventListener('submit', () => {
            globalSearch($('#globalSearchInput').value);
        });

        // Ticket reply
        $('#replyForm').addEventListener('submit', () => {
            const text = $('#replyInput').value.trim();
            if (!text) return;
            const t = tickets.find(tt => tt.id === appState.selectedTicketId);
            if (!t) return;
            t.messages.push({ sender: 'Agent', text, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) });
            t.updated = 'Just now';
            $('#replyInput').value = '';
            openTicket(t.id);
            renderTicketTable();
            renderRecentTickets();
        });

        // Student tabs
        $$('[data-student-tab]').forEach(b => {
            b.addEventListener('click', () => setStudentTab(b.dataset.studentTab));
        });
        $('#addNoteForm').addEventListener('submit', () => {
            const s = students.find(st => st.id === appState.selectedStudentId);
            const text = $('#noteInput').value.trim();
            if (!s || !text) return;
            s.notes.push({ text, time: new Date().toLocaleString() });
            $('#noteInput').value = '';
            openStudent(s.id);
            showToast('Note added');
        });

        // Notifications
        $('#notifBtn').addEventListener('click', () => {
            $('#notifMenu').classList.toggle('hidden');
            $('#avatarMenu').classList.add('hidden');
            renderNotifications();
        });
        $('#markAllRead').addEventListener('click', () => {
            appState.notifications.forEach(n => n.read = true);
            renderNotifications();
            updateNotifDot();
        });

        // Avatar dropdown
        $('#avatarBtn').addEventListener('click', () => {
            $('#avatarMenu').classList.toggle('hidden');
            $('#notifMenu').classList.add('hidden');
        });
        $('#signOutBtn').addEventListener('click', () => showToast('Demo only — not a real sign out'));

        // Close dropdowns if clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#notifBtn') && !e.target.closest('#notifMenu')) {
                $('#notifMenu').classList.add('hidden');
            }
            if (!e.target.closest('#avatarBtn') && !e.target.closest('#avatarMenu')) {
                $('#avatarMenu').classList.add('hidden');
            }
        });

        // Quick Create Modal
        function openCreateModal() {
            $('#backdrop').classList.add('show');
            $('#createModal').classList.remove('hidden');
        }
        function closeCreateModal() {
            $('#backdrop').classList.remove('show');
            $('#createModal').classList.add('hidden');
        }
        $('#quickCreateBtn').addEventListener('click', openCreateModal);
        $('#closeCreate').addEventListener('click', closeCreateModal);
        $('#cancelCreate').addEventListener('click', closeCreateModal);
        $('#backdrop').addEventListener('click', (e) => { if (e.target.id === 'backdrop') closeCreateModal(); });

        // Create form populate & submit
        function populateCreateStudents() {
            const sel = $('#createStudent');
            sel.innerHTML = students.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
        }
        $('#createForm').addEventListener('submit', () => {
            const subject = $('#createSubject').value.trim();
            const priority = $('#createPriority').value;
            const channel = $('#createChannel').value;
            const studentId = $('#createStudent').value;
            if (!subject) { showToast('Please enter a subject'); return; }
            const newId = 'TCK-' + (Math.floor(Math.random() * 9000) + 1000);
            const t = {
                id: newId, subject, status: 'Open', priority, channel, updated: 'Just now', assignee: 'Linh Tran', studentId,
                messages: [{ sender: 'Customer', text: subject, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) }]
            };
            tickets.unshift(t);
            renderTicketTable();
            renderRecentTickets();
            updateKpis();
            closeCreateModal();
            setView('inbox');
            showToast('Ticket created');
            // reset fields
            $('#createSubject').value = '';
            $('#createPriority').value = 'Low';
            $('#createChannel').value = 'email';
        });

        // Device controls
        $$('[data-device-btn]').forEach(b => {
            b.addEventListener('click', () => setDevice(b.dataset.deviceBtn));
        });
        $('#fitBtn').addEventListener('click', fitToWindow);
        window.addEventListener('resize', () => {
            // keep frame within viewport when in "Fit"
            if (!$$('[data-device-btn][aria-pressed="true"]').length) fitToWindow();
        });

        // Initial render
        function init() {
            // Use hash if present
            const initial = location.hash.replace('#', '') || 'ticket'; // đổi từ 'dashboard' thành 'inbox'
            setView(initial);
            updateKpis();
            renderRecentTickets();
            renderTicketTable();
            renderStudentsList();
            renderNotifications();
            updateNotifDot();
            populateCreateStudents();
            applyGridSpans();
        }
        init();
    </script>

    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'982ee39141499949',t:'MTc1ODUxMzU1OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>